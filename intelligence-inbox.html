<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligence Inbox - AI Business Insights</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #F4F5F8;
            color: #1a1a1a;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 72px;
            background: #F4F5F8;
            border-right: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 0;
            gap: 8px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .nav-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            color: #6b7280;
            transition: all 0.2s;
        }

        .nav-icon:hover {
            background: #f3f4f6;
            color: #2563eb;
        }

        .nav-icon.active {
            background: #eff6ff;
            color: #2563eb;
        }

        .nav-icon .material-icons {
            font-size: 24px;
        }

        /* Main Container */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar */
        .top-bar {
            height: 64px;
            background: #F4F5F8;
            border-bottom: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .restaurant-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            font-size: 14px;
        }

        .restaurant-info .material-icons {
            font-size: 18px;
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            color: #6b7280;
            transition: all 0.2s;
            background: none;
            border: none;
        }

        .icon-btn:hover {
            background: #f3f4f6;
            color: #1a1a1a;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            overflow: hidden;
            padding: 0 24px 24px 24px;
            gap: 0;
        }

        /* Unified Card Container */
        .unified-card {
            display: flex;
            flex: 1;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        /* Inbox Panel */
        .inbox-panel {
            width: 480px;
            background: #ffffff;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .inbox-header {
            padding: 24px 24px 20px 24px;
            border-bottom: none;
        }

        .inbox-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            background: #F4F5F8;
            padding: 4px;
            border-radius: 20px;
        }

        .tab {
            flex: 1;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.2s;
            position: relative;
            border: none;
            text-align: center;
        }

        .tab:hover {
            color: #1a1a1a;
            background: rgba(255, 255, 255, 0.5);
        }

        .tab.active {
            color: #1a1a1a;
            background: #ffffff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
        }

        .tab.has-new::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 6px;
            height: 6px;
            background: #ef4444;
            border-radius: 50%;
        }

        .inbox-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Insight Card */
        .insight-card {
            background: #ffffff;
            border: 1.5px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .insight-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .insight-card.active {
            border-color: #2563eb;
            background: #f8faff;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .card-category {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-category.boost {
            color: #10b981;
        }

        .card-category.attention {
            color: #f59e0b;
        }

        .card-category.margin {
            color: #3b82f6;
        }

        .card-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .card-icon.boost {
            background: #d1fae5;
            color: #10b981;
        }

        .card-icon.attention {
            background: #fef3c7;
            color: #f59e0b;
        }

        .card-icon.margin {
            background: #dbeafe;
            color: #3b82f6;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .card-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        .card-footer {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f3f4f6;
        }

        .impact-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .impact-badge.high {
            background: #d1fae5;
            color: #059669;
        }

        .impact-badge.medium {
            background: #fef3c7;
            color: #d97706;
        }

        .impact-badge .material-icons {
            font-size: 14px;
        }

        .time-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #f3f4f6;
            color: #6b7280;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .time-badge .material-icons {
            font-size: 12px;
        }

        /* Monitoring Widget */
        .monitoring-widget {
            background: #ffffff;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .widget-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .widget-title .material-icons {
            font-size: 18px;
            color: #2563eb;
        }

        .widget-action {
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: color 0.2s;
        }

        .widget-action:hover {
            color: #2563eb;
        }

        .widget-action .material-icons {
            font-size: 16px;
        }

        .widget-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
            margin-bottom: 24px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
            color: #1a1a1a;
        }

        .stat-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }

        .stat-change {
            font-size: 13px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
        }

        .stat-change .material-icons {
            font-size: 16px;
            color: #10b981;
        }

        .widget-footer {
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            font-size: 13px;
            color: #6b7280;
        }

        /* Feedback Section */
        .feedback-section {
            margin-top: 32px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1.5px solid #e5e7eb;
        }

        .feedback-header {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .feedback-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .feedback-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border: 1.5px solid #e5e7eb;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: #ffffff;
            color: #6b7280;
        }

        .feedback-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
            background: #eff6ff;
        }

        .feedback-btn .material-icons {
            font-size: 18px;
        }

        .feedback-btn.dismiss {
            color: #dc2626;
            border-color: #fecaca;
        }

        .feedback-btn.dismiss:hover {
            border-color: #dc2626;
            background: #fef2f2;
        }

        .feedback-icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: transparent;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }

        .feedback-icon-btn:hover {
            background: #f3f4f6;
            color: #1a1a1a;
        }

        .feedback-icon-btn .material-icons {
            font-size: 20px;
        }

        .feedback-icon-btn.active {
            background: #eff6ff;
            color: #2563eb;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal {
            background: #ffffff;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            color: #6b7280;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #1a1a1a;
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-label {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 12px;
            display: block;
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .modal-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            border: 1.5px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-option:hover {
            border-color: #cbd5e1;
            background: #f9fafb;
        }

        .modal-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .modal-option-text {
            font-size: 14px;
            color: #1a1a1a;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Status & Snooze */
        .status-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #f9fafb;
            border-radius: 10px;
            border: 1.5px solid #e5e7eb;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-indicator.pending {
            background: #fef3c7;
            color: #d97706;
        }

        .status-indicator.active {
            background: #dbeafe;
            color: #2563eb;
        }

        .status-indicator.completed {
            background: #d1fae5;
            color: #059669;
        }

        .status-indicator .material-icons {
            font-size: 16px;
        }

        .snooze-btn {
            margin-left: auto;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border: 1.5px solid #e5e7eb;
            border-radius: 18px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: #ffffff;
            color: #6b7280;
        }

        .snooze-btn:hover {
            border-color: #cbd5e1;
            background: #f9fafb;
        }

        .snooze-btn .material-icons {
            font-size: 16px;
        }

        .progress-section {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
        }

        .progress-value {
            font-size: 13px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }

        .progress-bar-fill.high-progress {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }

        /* Detail Panel */
        .detail-panel {
            flex: 1;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-panel-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            padding-bottom: 0;
        }

        .insight-content {
            display: none;
        }

        .insight-content.active {
            display: block;
        }

        .detail-header {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
        }

        .detail-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .detail-date {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 16px;
        }

        .header-feedback {
            display: flex;
            gap: 8px;
            position: absolute;
            bottom: 24px;
            right: 0;
        }

        .header-feedback-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.2s;
        }

        .header-feedback-btn:hover {
            background: #f3f4f6;
            color: #1a1a1a;
        }

        .header-feedback-btn .material-icons {
            font-size: 20px;
        }

        .view-data-link {
            float: right;
            display: flex;
            align-items: center;
            gap: 4px;
            color: #2563eb;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
        }

        .view-data-link:hover {
            color: #1d4ed8;
        }

        .detail-section {
            margin-bottom: 32px;
        }

        /* Hide action section in In Progress and Completed tabs */
        .detail-section.hide-actions {
            display: none;
        }

        .section-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        /* Actions Header */
        .actions-header {
            margin-bottom: 20px;
        }

        .actions-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 8px 0;
        }

        .actions-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }

        /* Action Pills */
        .action-pills {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-pill {
            padding: 0;
            border: none;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: #1a1a1a;
            text-align: left;
            width: 100%;
        }

        .action-pill.primary,
        .action-pill.secondary {
            padding: 18px 24px;
            border: 1.5px solid #e5e7eb;
            border-radius: 12px;
            background: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
            color: #1a1a1a;
            font-weight: 600;
            font-size: 15px;
        }

        .action-pill.primary:hover,
        .action-pill.secondary:hover {
            border-color: #cbd5e1;
            background: #f9fafb;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            transform: translateX(4px);
        }

        .action-pill.primary:active,
        .action-pill.secondary:active {
            transform: translateX(2px);
        }

        .action-pill-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .action-pill-icon,
        .action-pill-icon-small {
            font-size: 22px;
            flex-shrink: 0;
            color: #6b7280;
        }

        .action-pill-text {
            flex: 1;
            font-weight: 600;
            font-size: 15px;
            color: #1a1a1a;
        }

        .action-pill-arrow,
        .action-pill-arrow-small {
            font-size: 18px;
            color: #9ca3af;
            flex-shrink: 0;
        }

        .action-pill-badge {
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            margin-left: 12px;
        }

        .action-pill.selected {
            border-color: #2563eb;
            background: #eff6ff;
            color: #1a1a1a;
        }

        .action-pill.selected .action-pill-icon,
        .action-pill.selected .action-pill-icon-small {
            color: #2563eb;
        }

        .action-pill.selected .action-pill-arrow,
        .action-pill.selected .action-pill-arrow-small {
            color: #2563eb;
        }

        .action-pill.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .action-pill.disabled:hover {
            transform: none;
            border-color: #e5e7eb;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .action-pill.in-progress {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .action-pill.in-progress:hover {
            transform: none;
            border-color: #e5e7eb;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .action-pill.completed {
            cursor: not-allowed;
            pointer-events: none;
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        .action-pill.completed:hover {
            transform: none;
            border-color: #10b981;
            background: #d1fae5;
            box-shadow: 0 1px 3px rgba(16, 185, 129, 0.2);
        }

        .action-pill.completed .material-icons {
            color: #10b981;
        }

        .action-pill.completed .action-pill-badge {
            background: #ffffff;
            border-color: #10b981;
            color: #047857;
        }

        /* Icon Animations */
        @keyframes pointRight {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(4px);
            }
        }

        @keyframes sequentialDots {
            0% {
                opacity: 0.3;
            }
            33% {
                opacity: 1;
            }
            66% {
                opacity: 0.3;
            }
            100% {
                opacity: 0.3;
            }
        }

        @keyframes checkmarkWrite {
            0% {
                clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);
                opacity: 0;
            }
            50% {
                clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
                opacity: 1;
            }
            100% {
                clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
                opacity: 1;
            }
        }

        /* Apply animations to arrow icons */
        .action-pill:not(.in-progress):not(.completed) .action-pill-arrow,
        .action-pill:not(.in-progress):not(.completed) .action-pill-arrow-small {
            animation: pointRight 1.5s ease-in-out infinite;
        }

        /* Apply animation to 3-dot icon */
        .action-pill.in-progress .action-pill-arrow,
        .action-pill.in-progress .action-pill-arrow-small {
            animation: sequentialDots 1.5s ease-in-out infinite;
        }

        /* Apply animation to checkmark icon */
        .action-pill.completed .action-pill-arrow,
        .action-pill.completed .action-pill-arrow-small {
            animation: checkmarkWrite 0.6s ease-out forwards;
        }

        /* Form */
        .form-section {
            margin-bottom: 24px;
            display: none;
        }

        .form-section.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .form-grid.four-col {
            grid-template-columns: repeat(4, 1fr);
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .form-input {
            padding: 10px 14px;
            border: 1.5px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: #ffffff;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-select {
            padding: 10px 14px;
            border: 1.5px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            cursor: pointer;
            background: #ffffff;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236b7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 40px;
        }

        .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .permission-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f3f4f6;
            border-radius: 16px;
            font-size: 14px;
            color: #1a1a1a;
        }

        .permission-tag .material-icons {
            font-size: 16px;
            cursor: pointer;
            color: #6b7280;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 16px;
            margin-top: 32px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }

        .btn-secondary {
            background: #ffffff;
            border: 1.5px solid #e5e7eb;
            color: #1a1a1a;
        }

        .btn-secondary:hover {
            background: #f9fafb;
            border-color: #cbd5e1;
        }

        .btn-primary {
            background: #2563eb;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        /* Bottom Input */
        .bottom-input-area {
            position: sticky;
            bottom: 0;
            padding: 20px 32px 32px 32px;
            background: #ffffff;
            border-top: none;
            z-index: 10;
        }

        .search-input-container {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 14px 60px 14px 20px;
            border: 1.5px solid #e5e7eb;
            border-radius: 24px;
            font-size: 15px;
            font-family: inherit;
            background: #ffffff;
            height: 48px;
        }

        .search-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-submit {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: #2563eb;
            border: none;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-submit:hover {
            background: #1d4ed8;
        }

        .search-submit .material-icons {
            color: #ffffff;
            font-size: 20px;
        }

        /* Search Bar in Inbox */
        .inbox-search {
            padding: 20px 16px 32px 16px;
            border-top: none;
            background: #ffffff;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .inbox-search-input {
            width: 100%;
            padding: 14px 14px 14px 40px;
            border: 1.5px solid #e5e7eb;
            border-radius: 24px;
            font-size: 15px;
            font-family: inherit;
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7.33333 12.6667C10.2789 12.6667 12.6667 10.2789 12.6667 7.33333C12.6667 4.38781 10.2789 2 7.33333 2C4.38781 2 2 4.38781 2 7.33333C2 10.2789 4.38781 12.6667 7.33333 12.6667Z' stroke='%236b7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M14 14L11.1 11.1' stroke='%236b7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 16px center;
            height: 48px;
        }

        .inbox-search-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1a1a1a;
            color: #ffffff;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideInUp 0.3s ease-out;
            max-width: 400px;
        }

        .toast.hide {
            animation: slideOutDown 0.3s ease-in;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOutDown {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100px);
                opacity: 0;
            }
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-icon .material-icons {
            font-size: 16px;
            color: #ffffff;
        }

        .toast-message {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: #6b7280;
        }

        .empty-state .material-icons {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 13px;
            color: #9ca3af;
        }

        /* Evidence Section */
        .evidence-section {
            margin-bottom: 24px;
            border: 1.5px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            background: #ffffff;
        }

        .evidence-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
        }

        .evidence-header:hover {
            background: #f3f4f6;
        }

        .evidence-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .evidence-icon {
            width: 32px;
            height: 32px;
            background: #eff6ff;
            color: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .evidence-icon .material-icons {
            font-size: 20px;
        }

        .evidence-title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .evidence-toggle {
            transition: transform 0.2s;
            color: #6b7280;
        }

        .evidence-toggle.expanded {
            transform: rotate(180deg);
        }

        .evidence-content {
            display: none;
            padding: 20px;
            border-top: 1.5px solid #e5e7eb;
            animation: slideDown 0.3s ease-out;
        }

        .evidence-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .evidence-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .evidence-label {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .evidence-value {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 3px;
            transition: width 0.5s ease-out;
        }

        .confidence-fill.high {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .confidence-fill.medium {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .evidence-description {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.6;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .evidence-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #eff6ff;
            color: #2563eb;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">4</div>
        <div class="nav-icon active">
            <span class="material-icons">grid_view</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">hub</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">bar_chart</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">swap_horiz</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">access_time</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">groups</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">credit_card</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">desktop_windows</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">restaurant_menu</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">wb_sunny</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">public</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">settings</span>
        </div>
        <div class="nav-icon">
            <span class="material-icons">logout</span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="restaurant-info">
                <span class="material-icons">location_on</span>
                <span>Peter's Grill Brooklyn</span>
                <span>0021341010</span>
            </div>
            <div class="top-bar-actions">
                <button class="icon-btn">
                    <span class="material-icons">chat_bubble_outline</span>
                </button>
                <button class="icon-btn">
                    <span class="material-icons">shopping_cart</span>
                </button>
                <button class="icon-btn">
                    <span class="material-icons">account_circle</span>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <div class="unified-card">
                <!-- Inbox Panel -->
                <div class="inbox-panel">
                    <div class="inbox-header">
                        <h1 class="inbox-title">Intelligence Inbox (<span id="inbox-count">3</span>)</h1>
                        <div class="tabs">
                            <div class="tab active" data-tab="new">New</div>
                            <div class="tab" data-tab="in-progress">In Progress</div>
                            <div class="tab" data-tab="completed">Completed</div>
                        </div>
                    </div>

                    <div class="inbox-list" id="inbox-list">
                    <!-- Messages will be dynamically inserted here -->
                </div>

                    <div class="inbox-search">
                        <input type="text" class="inbox-search-input" placeholder="Search in inbox">
                    </div>
                </div>

                <!-- Detail Panel -->
                <div class="detail-panel">
                    <div class="detail-panel-scroll">
                <!-- Content for Insight 1: Weekend Boost -->
                <div class="insight-content active" id="insight-boost">
                    <div class="detail-header">
                        <a href="#" class="view-data-link" onclick="event.preventDefault(); showEvidenceModal('boost')">
                            <span class="material-icons">bar_chart</span>
                            View Data Evidence
                        </a>
                        <h2 class="detail-title">Boost $900-$1,400/week</h2>
                        <p class="detail-date">Dec 17, 2025, 1:15 PM</p>
                        <div class="header-feedback">
                            <button class="header-feedback-btn" onclick="provideFeedback('boost', 'helpful')" title="Helpful">
                                <span class="material-icons">thumb_up</span>
                            </button>
                            <button class="header-feedback-btn" onclick="provideFeedback('boost', 'not-helpful')" title="Not helpful">
                                <span class="material-icons">thumb_down</span>
                            </button>
                        </div>
                    </div>

                    <div class="detail-section">
                        <div class="actions-header">
                            <h3 class="actions-title">
                                <span class="material-icons" style="font-size: 24px; color: #2563eb;">flash_on</span>
                                Recommended Actions
                            </h3>
                            <p class="actions-subtitle">Choose an action to get started</p>
                        </div>
                        <div class="action-pills">
                            <button class="action-pill primary" data-action="cook" data-insight="boost">
                                <span class="material-icons action-pill-icon">person_add</span>
                                <span style="flex: 1;">Add 1 flex cook during peak hours</span>
                                <span class="action-pill-badge">Recommended</span>
                                <span class="material-icons action-pill-arrow">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="menu" data-insight="boost">
                                <span class="material-icons action-pill-icon-small">menu_book</span>
                                <span style="flex: 1;">Remove long-prep weekend items</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="training" data-insight="boost">
                                <span class="material-icons action-pill-icon-small">school</span>
                                <span style="flex: 1;">Provide training for staff</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Content for Insight 2: Appetizer Recovery -->
                <div class="insight-content" id="insight-appetizer">
                    <div class="detail-header">
                        <a href="#" class="view-data-link" onclick="event.preventDefault(); showEvidenceModal('appetizer')">
                            <span class="material-icons">bar_chart</span>
                            View Data Evidence
                        </a>
                        <h2 class="detail-title">Recover $1200 this week</h2>
                        <p class="detail-date">Dec 18, 2025, 9:30 AM</p>
                        <div class="header-feedback">
                            <button class="header-feedback-btn" onclick="provideFeedback('appetizer', 'helpful')" title="Helpful">
                                <span class="material-icons">thumb_up</span>
                            </button>
                            <button class="header-feedback-btn" onclick="provideFeedback('appetizer', 'not-helpful')" title="Not helpful">
                                <span class="material-icons">thumb_down</span>
                            </button>
                        </div>
                    </div>

                    <div class="detail-section">
                        <div class="actions-header">
                            <h3 class="actions-title">
                                <span class="material-icons" style="font-size: 24px; color: #2563eb;">flash_on</span>
                                Recommended Actions
                            </h3>
                            <p class="actions-subtitle">Choose an action to get started</p>
                        </div>
                        <div class="action-pills">
                            <button class="action-pill primary" data-action="appetizer-training" data-insight="appetizer">
                                <span class="material-icons action-pill-icon">stars</span>
                                <span style="flex: 1;">Train servers on appetizer upselling</span>
                                <span class="action-pill-badge">Recommended</span>
                                <span class="material-icons action-pill-arrow">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="appetizer-menu" data-insight="appetizer">
                                <span class="material-icons action-pill-icon-small">restaurant_menu</span>
                                <span style="flex: 1;">Create appetizer combo deals</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="appetizer-display" data-insight="appetizer">
                                <span class="material-icons action-pill-icon-small">storefront</span>
                                <span style="flex: 1;">Add appetizer display boards</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Content for Insight 3: Order Volume Recovery -->
                <div class="insight-content" id="insight-volume">
                    <div class="detail-header">
                        <a href="#" class="view-data-link" onclick="event.preventDefault(); showEvidenceModal('volume')">
                            <span class="material-icons">bar_chart</span>
                            View Data Evidence
                        </a>
                        <h2 class="detail-title">Recover $1440</h2>
                        <p class="detail-date">Dec 18, 2025, 10:45 AM</p>
                        <div class="header-feedback">
                            <button class="header-feedback-btn" onclick="provideFeedback('volume', 'helpful')" title="Helpful">
                                <span class="material-icons">thumb_up</span>
                            </button>
                            <button class="header-feedback-btn" onclick="provideFeedback('volume', 'not-helpful')" title="Not helpful">
                                <span class="material-icons">thumb_down</span>
                            </button>
                        </div>
                    </div>

                    <div class="detail-section">
                        <div class="actions-header">
                            <h3 class="actions-title">
                                <span class="material-icons" style="font-size: 24px; color: #2563eb;">flash_on</span>
                                Recommended Actions
                            </h3>
                            <p class="actions-subtitle">Choose an action to get started</p>
                        </div>
                        <div class="action-pills">
                            <button class="action-pill primary" data-action="marketing" data-insight="volume">
                                <span class="material-icons action-pill-icon">campaign</span>
                                <span style="flex: 1;">Launch targeted marketing campaign</span>
                                <span class="action-pill-badge">Recommended</span>
                                <span class="material-icons action-pill-arrow">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="promotion" data-insight="volume">
                                <span class="material-icons action-pill-icon-small">card_giftcard</span>
                                <span style="flex: 1;">Create limited-time promotions</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                            <button class="action-pill secondary" data-action="delivery" data-insight="volume">
                                <span class="material-icons action-pill-icon-small">local_shipping</span>
                                <span style="flex: 1;">Optimize delivery platform presence</span>
                                <span class="material-icons action-pill-arrow-small">arrow_forward</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Form for Cook Action -->
                <div class="form-section" id="form-cook">
                    <h3 class="form-title">Please enter the cook's information:</h3>

                    <div class="form-grid four-col">
                        <div class="form-field">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" placeholder="First" value="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" placeholder="Last" value="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Payroll ID</label>
                            <input type="text" class="form-input" placeholder="123456" value="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Employee ID</label>
                            <input type="text" class="form-input" placeholder="123456" value="">
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-field">
                            <label class="form-label">Permissions</label>
                            <div style="padding: 10px 0;">
                                <span class="permission-tag">
                                    Cook
                                    <span class="material-icons">close</span>
                                </span>
                            </div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Job*</label>
                            <select class="form-select">
                                <option>Manager</option>
                                <option selected>Cook</option>
                                <option>Server</option>
                                <option>Host</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Pay Rate*</label>
                            <input type="text" class="form-input" placeholder="1.00" value="">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('cook')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('cook')">Submit</button>
                    </div>
                </div>

                <!-- Form for Menu Action -->
                <div class="form-section" id="form-menu">
                    <h3 class="form-title">Select items to remove from weekend menu:</h3>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Menu Items</label>
                        <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; padding: 12px; border: 1.5px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 500; color: #1a1a1a;">Braised Short Rib</div>
                                    <div style="font-size: 13px; color: #6b7280;">Prep time: 45 min | Cost: $12.50</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; padding: 12px; border: 1.5px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 500; color: #1a1a1a;">Stuffed Chicken Breast</div>
                                    <div style="font-size: 13px; color: #6b7280;">Prep time: 35 min | Cost: $9.75</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; padding: 12px; border: 1.5px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 500; color: #1a1a1a;">Lobster Risotto</div>
                                    <div style="font-size: 13px; color: #6b7280;">Prep time: 40 min | Cost: $15.00</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Effective Date</label>
                        <input type="date" class="form-input">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('menu')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('menu')">Submit</button>
                    </div>
                </div>

                <!-- Form for Training Action -->
                <div class="form-section" id="form-training">
                    <h3 class="form-title">Schedule staff training session:</h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Training Topic*</label>
                            <select class="form-select">
                                <option>Speed & Efficiency</option>
                                <option>Food Safety</option>
                                <option>Customer Service</option>
                                <option>New Menu Items</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Duration</label>
                            <select class="form-select">
                                <option>1 hour</option>
                                <option>2 hours</option>
                                <option>3 hours</option>
                                <option>Half day</option>
                                <option>Full day</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-field">
                            <label class="form-label">Date*</label>
                            <input type="date" class="form-input">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Time*</label>
                            <input type="time" class="form-input">
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Staff Members</label>
                        <input type="text" class="form-input" placeholder="All kitchen staff">
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Notes (optional)</label>
                        <textarea class="form-input" style="min-height: 80px; resize: vertical;" placeholder="Add any additional details..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('training')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('training')">Submit</button>
                    </div>
                </div>

                <!-- Form for Appetizer Training Action -->
                <div class="form-section" id="form-appetizer-training">
                    <h3 class="form-title">Setup appetizer upselling training:</h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Training Date*</label>
                            <input type="date" class="form-input">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Session Length</label>
                            <select class="form-select">
                                <option>30 minutes</option>
                                <option selected>1 hour</option>
                                <option>2 hours</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Staff to Train</label>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">All servers</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Host staff</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Managers only</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Focus Items (optional)</label>
                        <input type="text" class="form-input" placeholder="e.g., Wings, Nachos, Calamari">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('appetizer-training')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('appetizer-training')">Submit</button>
                    </div>
                </div>

                <!-- Form for Appetizer Menu Action -->
                <div class="form-section" id="form-appetizer-menu">
                    <h3 class="form-title">Create appetizer combo deals:</h3>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Combo Deal Name*</label>
                        <input type="text" class="form-input" placeholder="e.g., Starter Sampler">
                    </div>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Regular Price*</label>
                            <input type="text" class="form-input" placeholder="$24.99">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Combo Price*</label>
                            <input type="text" class="form-input" placeholder="$19.99">
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Items Included</label>
                        <textarea class="form-input" style="min-height: 80px; resize: vertical;" placeholder="List the appetizers included in this combo..."></textarea>
                    </div>

                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-field">
                            <label class="form-label">Start Date*</label>
                            <input type="date" class="form-input">
                        </div>
                        <div class="form-field">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-input">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('appetizer-menu')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('appetizer-menu')">Submit</button>
                    </div>
                </div>

                <!-- Form for Appetizer Display Action -->
                <div class="form-section" id="form-appetizer-display">
                    <h3 class="form-title">Order appetizer display boards:</h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Display Type*</label>
                            <select class="form-select">
                                <option>Table Tents</option>
                                <option>Digital Screens</option>
                                <option>Chalkboards</option>
                                <option>Menu Inserts</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Quantity*</label>
                            <input type="number" class="form-input" placeholder="20" value="20">
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Placement Locations</label>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">All tables</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Bar area</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Host stand</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Budget*</label>
                        <input type="text" class="form-input" placeholder="$500">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('appetizer-display')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('appetizer-display')">Submit</button>
                    </div>
                </div>

                <!-- Form for Marketing Action -->
                <div class="form-section" id="form-marketing">
                    <h3 class="form-title">Launch targeted marketing campaign:</h3>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Campaign Name*</label>
                        <input type="text" class="form-input" placeholder="e.g., Weekend Dinner Rush">
                    </div>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Target Audience</label>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Past customers (last 30 days)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Nearby residents (2 mile radius)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Email subscribers</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Platform*</label>
                            <select class="form-select">
                                <option>Instagram & Facebook</option>
                                <option>Google Ads</option>
                                <option>Email Marketing</option>
                                <option>SMS Campaign</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Budget*</label>
                            <input type="text" class="form-input" placeholder="$300">
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-field">
                            <label class="form-label">Start Date*</label>
                            <input type="date" class="form-input">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Duration</label>
                            <select class="form-select">
                                <option>1 week</option>
                                <option>2 weeks</option>
                                <option selected>1 month</option>
                                <option>3 months</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('marketing')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('marketing')">Submit</button>
                    </div>
                </div>

                <!-- Form for Promotion Action -->
                <div class="form-section" id="form-promotion">
                    <h3 class="form-title">Create limited-time promotion:</h3>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Promotion Name*</label>
                        <input type="text" class="form-input" placeholder="e.g., Happy Hour Special">
                    </div>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-label">Discount Type*</label>
                            <select class="form-select">
                                <option>Percentage Off</option>
                                <option>Dollar Amount Off</option>
                                <option>Buy One Get One</option>
                                <option>Fixed Price</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Discount Value*</label>
                            <input type="text" class="form-input" placeholder="20%">
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Applies To</label>
                        <select class="form-select">
                            <option>Entire Menu</option>
                            <option>Specific Items</option>
                            <option>Minimum Purchase</option>
                            <option>Delivery Only</option>
                        </select>
                    </div>

                    <div class="form-grid" style="margin-top: 16px;">
                        <div class="form-field">
                            <label class="form-label">Start Date*</label>
                            <input type="date" class="form-input">
                        </div>
                        <div class="form-field">
                            <label class="form-label">End Date*</label>
                            <input type="date" class="form-input">
                        </div>
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Promotion Code</label>
                        <input type="text" class="form-input" placeholder="HAPPYHOUR20">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('promotion')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('promotion')">Submit</button>
                    </div>
                </div>

                <!-- Form for Delivery Action -->
                <div class="form-section" id="form-delivery">
                    <h3 class="form-title">Optimize delivery platform presence:</h3>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Platforms to Optimize</label>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">DoorDash</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Uber Eats</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Grubhub</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-field" style="margin-bottom: 16px;">
                        <label class="form-label">Optimization Actions</label>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Update menu photos</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Improve item descriptions</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Add promotional banners</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 14px;">Optimize search keywords</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Target Completion Date*</label>
                        <input type="date" class="form-input">
                    </div>

                    <div class="form-field" style="margin-top: 16px;">
                        <label class="form-label">Notes (optional)</label>
                        <textarea class="form-input" style="min-height: 60px; resize: vertical;" placeholder="Any specific requirements or ideas..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="cancelForm('delivery')">Cancel</button>
                        <button class="btn btn-primary" onclick="submitForm('delivery')">Submit</button>
                    </div>
                </div>
                    </div>

                    <!-- Bottom Input Area -->
                    <div class="bottom-input-area">
                        <div class="search-input-container">
                            <input type="text" class="search-input" placeholder="Ask me anything...">
                            <button class="search-submit">
                                <span class="material-icons">send</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Evidence Modal -->
    <div class="modal-overlay" id="evidenceModal" onclick="if(event.target === this) closeEvidenceModal()">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Data Evidence & Methodology</h3>
                <div class="modal-close" onclick="closeEvidenceModal()">
                    <span class="material-icons">close</span>
                </div>
            </div>
            <div class="modal-body" id="evidenceModalContent">
                <!-- Content will be inserted dynamically -->
            </div>
        </div>
    </div>

    <!-- Dismiss Modal -->
    <div class="modal-overlay" id="dismissModal" onclick="if(event.target === this) closeDismissModal()">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Why are you dismissing this insight?</h3>
                <div class="modal-close" onclick="closeDismissModal()">
                    <span class="material-icons">close</span>
                </div>
            </div>
            <div class="modal-body">
                <label class="modal-label">Please select a reason:</label>
                <div class="modal-options">
                    <label class="modal-option">
                        <input type="radio" name="dismiss-reason" value="not-relevant">
                        <span class="modal-option-text">Not relevant to my business</span>
                    </label>
                    <label class="modal-option">
                        <input type="radio" name="dismiss-reason" value="already-implemented">
                        <span class="modal-option-text">Already implemented this</span>
                    </label>
                    <label class="modal-option">
                        <input type="radio" name="dismiss-reason" value="too-expensive">
                        <span class="modal-option-text">Too expensive to implement</span>
                    </label>
                    <label class="modal-option">
                        <input type="radio" name="dismiss-reason" value="not-now">
                        <span class="modal-option-text">Not right now, maybe later</span>
                    </label>
                    <label class="modal-option">
                        <input type="radio" name="dismiss-reason" value="inaccurate">
                        <span class="modal-option-text">Data seems inaccurate</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDismissModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmDismiss()">Dismiss Insight</button>
            </div>
        </div>
    </div>

    <script>
        // Parent insight messages - always stay in New tab
        const insightMessages = [
            {
                id: 'boost',
                category: 'boost',
                categoryLabel: 'Weekly Boost',
                icon: 'trending_up',
                title: '$900-$1400/week',
                subtitle: 'Weekend Ticket Volume',
                impact: 'high',
                impactLabel: 'High Impact',
                timeframe: '2-3 weeks',
                monitoring: {
                    inProgress: {
                        title: 'Live Tracking',
                        stats: [
                            { value: '$1,240', label: 'Revenue Impact', change: '+$340 vs projection', icon: 'trending_up' },
                            { value: '14 min', label: 'Avg Ticket Time', change: '-4 min improvement', icon: 'trending_down' },
                            { value: '87%', label: 'Goal Progress', change: 'Updated 2h ago', icon: 'access_time' }
                        ],
                        footer: 'Based on 3 days of data since implementation started'
                    },
                    completed: {
                        title: 'Final Results',
                        stats: [
                            { value: '$1,380', label: 'Revenue Impact', change: '+$480 vs projection', icon: 'trending_up' },
                            { value: '12 min', label: 'Avg Ticket Time', change: '-6 min improvement', icon: 'trending_down' },
                            { value: '100%', label: 'Goal Achieved', change: 'Completed 2 weeks ago', icon: 'check_circle' }
                        ],
                        footer: 'Based on 2 weeks of implementation data'
                    }
                },
                evidence: {
                    confidence: { value: '87%', width: 87, type: 'high' },
                    dataSource: { value: '8 weeks of POS data', detail: '2,847 transactions analyzed' },
                    successRate: { value: '73% of similar venues', detail: 'Based on 152 restaurants' },
                    timeframe: { value: '2-3 weeks', detail: 'To see full results' },
                    methodology: 'Our AI analyzed weekend ticket volumes from 6-10 PM and identified a 18-minute average ticket time vs. 12-minute optimal benchmark. By comparing with similar restaurants that reduced ticket times, we project $900-$1,400 weekly revenue increase through faster table turnover and reduced customer wait times.'
                }
            },
            {
                id: 'appetizer',
                category: 'attention',
                categoryLabel: 'Needs Attention',
                icon: 'trending_down',
                title: 'Recover $1200 this week',
                subtitle: '-8% appetizer rate',
                impact: 'high',
                impactLabel: 'High Impact',
                timeframe: '1-2 weeks',
                monitoring: {
                    inProgress: {
                        title: 'Live Tracking',
                        stats: [
                            { value: '$820', label: 'Revenue Impact', change: '68% of goal reached', icon: 'trending_up' },
                            { value: '39%', label: 'Appetizer Rate', change: '+5% improvement', icon: 'trending_up' },
                            { value: '68%', label: 'Goal Progress', change: 'Updated 1h ago', icon: 'access_time' }
                        ],
                        footer: 'Based on 5 days of data since training was implemented'
                    },
                    completed: {
                        title: 'Final Results',
                        stats: [
                            { value: '$1,250', label: 'Revenue Impact', change: '104% of goal reached', icon: 'trending_up' },
                            { value: '43%', label: 'Appetizer Rate', change: '+9% improvement', icon: 'trending_up' },
                            { value: '100%', label: 'Goal Achieved', change: 'Completed 1 week ago', icon: 'check_circle' }
                        ],
                        footer: 'Based on 1 week of implementation data'
                    }
                },
                evidence: {
                    confidence: { value: '92%', width: 92, type: 'high' },
                    dataSource: { value: '6 weeks of sales data', detail: '1,923 dinner orders analyzed' },
                    successRate: { value: '81% of similar venues', detail: 'Based on 203 restaurants' },
                    timeframe: { value: '1-2 weeks', detail: 'To see full results' },
                    methodology: 'Analysis shows your appetizer attachment rate dropped 8% from 42% to 34% over the past 6 weeks. Comparing against successful recovery strategies from 203 similar restaurants, implementing server training and visual prompts typically recovers $1,100-$1,300 weekly through improved appetizer sales.'
                }
            },
            {
                id: 'volume',
                category: 'margin',
                categoryLabel: 'Highest Margin',
                icon: 'attach_money',
                title: 'Recover $1440',
                subtitle: '-8% order volume',
                impact: 'medium',
                impactLabel: 'Med Impact',
                timeframe: '3-4 weeks',
                monitoring: {
                    inProgress: {
                        title: 'Live Tracking',
                        stats: [
                            { value: '$480', label: 'Revenue Impact', change: '33% of goal reached', icon: 'trending_up' },
                            { value: '271', label: 'Weekly Orders', change: '+9 orders vs last week', icon: 'trending_up' },
                            { value: '33%', label: 'Goal Progress', change: 'Updated 3h ago', icon: 'access_time' }
                        ],
                        footer: 'Based on 1 week of data since campaign launch'
                    },
                    completed: {
                        title: 'Final Results',
                        stats: [
                            { value: '$1,520', label: 'Revenue Impact', change: '106% of goal reached', icon: 'trending_up' },
                            { value: '286', label: 'Weekly Orders', change: '+24 orders improvement', icon: 'trending_up' },
                            { value: '100%', label: 'Goal Achieved', change: 'Completed 3 weeks ago', icon: 'check_circle' }
                        ],
                        footer: 'Based on 3 weeks of implementation data'
                    }
                },
                evidence: {
                    confidence: { value: '78%', width: 78, type: 'medium' },
                    dataSource: { value: '12 weeks of order data', detail: '3,421 orders analyzed' },
                    successRate: { value: '68% of similar venues', detail: 'Based on 187 restaurants' },
                    timeframe: { value: '3-4 weeks', detail: 'To see full results' },
                    methodology: 'Your order volume decreased 8% over 12 weeks (from 285 to 262 weekly orders). Analysis of 187 similar venues that recovered from volume drops shows that targeted marketing combined with promotions typically recovers $1,200-$1,600 in weekly revenue within one month.'
                }
            }
        ];

        // Action items that have been submitted (created dynamically)
        const submittedActions = [];

        // Track which actions have been viewed in each tab
        const viewedActions = new Set();

        // Action metadata for creating cards
        const actionMetadata = {
            'cook': { title: 'Add 1 flex cook during peak hours', parentTitle: '$900-$1400/week' },
            'menu': { title: 'Remove long-prep weekend items', parentTitle: '$900-$1400/week' },
            'training': { title: 'Provide training for staff', parentTitle: '$900-$1400/week' },
            'appetizer-training': { title: 'Train servers on appetizer upselling', parentTitle: 'Recover $1200 this week' },
            'appetizer-menu': { title: 'Create appetizer combo deals', parentTitle: 'Recover $1200 this week' },
            'appetizer-display': { title: 'Add appetizer display boards', parentTitle: 'Recover $1200 this week' },
            'marketing': { title: 'Launch targeted marketing campaign', parentTitle: 'Recover $1440' },
            'promotion': { title: 'Create limited-time promotions', parentTitle: 'Recover $1440' },
            'delivery': { title: 'Optimize delivery platform presence', parentTitle: 'Recover $1440' }
        };

        let currentTab = 'new';
        let activeItemId = null;

        // Render messages based on current tab
        function renderMessages() {
            const inboxList = document.getElementById('inbox-list');

            if (currentTab === 'new') {
                // Show parent insight messages in New tab
                inboxList.innerHTML = insightMessages.map((msg, index) => `
                    <div class="insight-card ${index === 0 && !activeItemId ? 'active' : ''} ${activeItemId === msg.id ? 'active' : ''}"
                         data-item-id="${msg.id}"
                         data-insight="${msg.id}">
                        <div class="card-header">
                            <span class="card-category ${msg.category}">${msg.categoryLabel}</span>
                            <div class="card-icon ${msg.category}">
                                <span class="material-icons">${msg.icon}</span>
                            </div>
                        </div>
                        <h3 class="card-title">${msg.title}</h3>
                        <p class="card-subtitle">${msg.subtitle}</p>
                        <div class="card-footer">
                            <span class="impact-badge ${msg.impact}">
                                <span class="material-icons">bolt</span>
                                ${msg.impactLabel}
                            </span>
                            <span class="time-badge">
                                <span class="material-icons">schedule</span>
                                ${msg.timeframe}
                            </span>
                        </div>
                    </div>
                `).join('');

                // Set active item if none selected
                if (!activeItemId && insightMessages.length > 0) {
                    activeItemId = insightMessages[0].id;
                    showInsightContent(insightMessages[0].id);
                }
            } else {
                // Show submitted action items for In Progress and Completed tabs
                const filteredActions = submittedActions.filter(action => action.status === currentTab);

                if (filteredActions.length === 0) {
                    inboxList.innerHTML = `
                        <div class="empty-state">
                            <span class="material-icons">inbox</span>
                            <div class="empty-state-text">No actions here</div>
                            <div class="empty-state-subtext">${getEmptyStateText()}</div>
                        </div>
                    `;
                    // Hide detail panel when no items
                    document.querySelectorAll('.insight-content').forEach(content => content.classList.remove('active'));
                    return;
                }

                inboxList.innerHTML = filteredActions.map((action, index) => {
                    // Find parent to get impact data
                    const parent = insightMessages.find(msg => msg.id === action.parentId);
                    return `
                    <div class="insight-card ${index === 0 && !activeItemId ? 'active' : ''} ${activeItemId === action.id ? 'active' : ''}"
                         data-item-id="${action.id}"
                         data-parent-id="${action.parentId}"
                         data-action="${action.action}">
                        <div class="card-header">
                            <span class="card-category ${action.category}">${action.categoryLabel}</span>
                            <div class="card-icon ${action.category}">
                                <span class="material-icons">${action.icon}</span>
                            </div>
                        </div>
                        <h3 class="card-title">${action.title}</h3>
                        <p class="card-subtitle">${action.subtitle}</p>
                        ${parent ? `
                        <div class="card-footer">
                            <span class="impact-badge ${parent.impact}">
                                <span class="material-icons">bolt</span>
                                ${parent.impactLabel}
                            </span>
                            <span class="time-badge">
                                <span class="material-icons">schedule</span>
                                ${parent.timeframe}
                            </span>
                        </div>
                        ` : ''}
                    </div>
                    `;
                }).join('');

                // Set active item if none selected
                if (!activeItemId && filteredActions.length > 0) {
                    activeItemId = filteredActions[0].id;
                    showInsightContent(filteredActions[0].parentId, filteredActions[0].action);
                    // Don't mark as viewed on auto-selection - only when user explicitly clicks
                }
            }

            // Update count
            updateInboxCount();

            // Attach click handlers to new cards
            attachCardClickHandlers();

            // Update notification dots after rendering
            updateNotificationDots();
        }

        function getEmptyStateText() {
            if (currentTab === 'new') return 'All insights have been reviewed';
            if (currentTab === 'in-progress') return 'Start working on new insights';
            if (currentTab === 'completed') return 'Completed actions will appear here';
            return '';
        }

        function updateInboxCount() {
            // Count is always 3 in New tab (the parent insights)
            document.getElementById('inbox-count').textContent = '3';
        }

        // Attach click handlers to cards
        function attachCardClickHandlers() {
            document.querySelectorAll('.insight-card').forEach(card => {
                card.addEventListener('click', function() {
                    // Update active card
                    document.querySelectorAll('.insight-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');

                    // Get item info
                    activeItemId = this.getAttribute('data-item-id');

                    if (currentTab === 'new') {
                        // For New tab, show the insight content with action pills
                        const insightId = this.getAttribute('data-insight');
                        showInsightContent(insightId);

                        // Hide forms initially
                        document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));

                        // Re-attach event listeners to action pills
                        attachActionPillListeners();
                    } else {
                        // For In Progress and Completed, show parent insight content with action info
                        const parentId = this.getAttribute('data-parent-id');
                        const actionType = this.getAttribute('data-action');
                        showInsightContent(parentId, actionType);

                        // Mark this action as viewed
                        viewedActions.add(activeItemId);

                        // Update notification dots
                        updateNotificationDots();

                        // Hide all forms
                        document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));
                    }
                });
            });
        }

        function showInsightContent(insightId, actionType = null) {
            document.querySelectorAll('.insight-content').forEach(content => content.classList.remove('active'));
            const targetContent = document.getElementById('insight-' + insightId);
            if (targetContent) {
                targetContent.classList.add('active');

                // Update title if in In Progress or Completed tabs
                if ((currentTab === 'in-progress' || currentTab === 'completed') && actionType) {
                    const titleElement = targetContent.querySelector('.detail-title');
                    const actionMeta = actionMetadata[actionType];
                    if (titleElement && actionMeta) {
                        titleElement.textContent = actionMeta.title;
                    }

                    // Hide action pills section in In Progress/Completed tabs
                    const detailSection = targetContent.querySelector('.detail-section');
                    if (detailSection) {
                        detailSection.classList.add('hide-actions');
                    }
                } else {
                    // Reset to original title in New tab
                    const insight = insightMessages.find(msg => msg.id === insightId);
                    if (insight) {
                        const titleElement = targetContent.querySelector('.detail-title');
                        if (titleElement) {
                            // Reconstruct original title format
                            if (insight.id === 'boost') {
                                titleElement.textContent = 'Boost $900-$1,400/week';
                            } else if (insight.id === 'appetizer') {
                                titleElement.textContent = 'Recover $1200 this week';
                            } else if (insight.id === 'volume') {
                                titleElement.textContent = 'Recover $1440';
                            }
                        }
                    }

                    // Show action pills section in New tab
                    const detailSection = targetContent.querySelector('.detail-section');
                    if (detailSection) {
                        detailSection.classList.remove('hide-actions');
                    }
                }

                // Update monitoring widget based on current tab
                updateMonitoringWidget(insightId);
            }
        }

        function updateMonitoringWidget(insightId) {
            const insight = insightMessages.find(msg => msg.id === insightId);
            if (!insight || !insight.monitoring) return;

            const targetContent = document.getElementById('insight-' + insightId);
            if (!targetContent) return;

            // Remove existing monitoring widget if present
            const existingWidget = targetContent.querySelector('.monitoring-widget');
            if (existingWidget) {
                existingWidget.remove();
            }

            // Only show widget in In Progress and Completed tabs
            if (currentTab !== 'in-progress' && currentTab !== 'completed') {
                return;
            }

            // Get the appropriate monitoring data
            const monitoringData = currentTab === 'in-progress' ? insight.monitoring.inProgress : insight.monitoring.completed;

            // Create monitoring widget HTML (without View Details button)
            const widgetHTML = `
                <div class="monitoring-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="material-icons">insights</span>
                            ${monitoringData.title}
                        </div>
                    </div>
                    <div class="widget-stats">
                        ${monitoringData.stats.map(stat => `
                            <div class="stat-item">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                                <div class="stat-change">
                                    <span class="material-icons">${stat.icon}</span>
                                    ${stat.change}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="widget-footer">
                        ${monitoringData.footer}
                    </div>
                </div>
            `;

            // Insert widget after the detail-header and before detail-section
            const detailHeader = targetContent.querySelector('.detail-header');
            const detailSection = targetContent.querySelector('.detail-section');

            if (detailHeader && detailSection) {
                detailHeader.insertAdjacentHTML('afterend', widgetHTML);
            }
        }

        // Action pill click handler function
        // Update action pill states based on submitted actions
        function updateActionPillStates() {
            document.querySelectorAll('.action-pill').forEach(pill => {
                const action = pill.getAttribute('data-action');

                // Check if this action has been submitted
                const submittedAction = submittedActions.find(a => a.action === action);

                if (submittedAction) {
                    const arrowIcon = pill.querySelector('.action-pill-arrow, .action-pill-arrow-small');

                    if (submittedAction.status === 'in-progress') {
                        pill.classList.add('in-progress');
                        pill.classList.remove('completed');
                        // Change arrow to 3-dot icon
                        if (arrowIcon) {
                            arrowIcon.textContent = 'more_horiz';
                        }
                    } else if (submittedAction.status === 'completed') {
                        pill.classList.add('completed');
                        pill.classList.remove('in-progress');
                        // Change arrow to checkmark
                        if (arrowIcon) {
                            arrowIcon.textContent = 'check';
                        }
                    }
                } else {
                    // Reset if not submitted
                    pill.classList.remove('in-progress', 'completed');
                    const arrowIcon = pill.querySelector('.action-pill-arrow, .action-pill-arrow-small');
                    if (arrowIcon) {
                        arrowIcon.textContent = 'arrow_forward';
                    }
                }
            });
        }

        function attachActionPillListeners() {
            document.querySelectorAll('.action-pill').forEach(pill => {
                // Remove existing listeners by cloning
                const newPill = pill.cloneNode(true);
                pill.parentNode.replaceChild(newPill, pill);

                newPill.addEventListener('click', function() {
                    // Don't allow clicking in-progress or completed pills
                    if (this.classList.contains('in-progress') || this.classList.contains('completed')) {
                        return;
                    }

                    const action = this.getAttribute('data-action');
                    const insightType = this.getAttribute('data-insight');

                    // Remove selected class from pills in current insight
                    const currentInsight = document.getElementById('insight-' + insightType);
                    if (currentInsight) {
                        currentInsight.querySelectorAll('.action-pill').forEach(p => p.classList.remove('selected'));
                    }

                    // Add selected class to clicked pill
                    this.classList.add('selected');

                    // Hide all forms
                    document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));

                    // Show the corresponding form
                    const form = document.getElementById('form-' + action);
                    if (form) {
                        form.classList.add('active');
                    }
                });
            });
        }

        // Initial attachment
        attachActionPillListeners();

        // Toast notification
        function showToast(message) {
            // Remove existing toast if any
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="toast-icon">
                    <span class="material-icons">check</span>
                </div>
                <div class="toast-message">${message}</div>
            `;

            document.body.appendChild(toast);

            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Form submission handler
        function submitForm(action) {
            // Get the corresponding pill
            const pill = document.querySelector(`.action-pill[data-action="${action}"]`);

            if (!pill) return;

            // Remove selected class and add completed class
            pill.classList.remove('selected');
            pill.classList.add('completed');

            // Add checkmark icon if not already there
            if (!pill.querySelector('.material-icons')) {
                const checkmark = document.createElement('span');
                checkmark.className = 'material-icons';
                checkmark.textContent = 'check_circle';
                pill.appendChild(checkmark);
            }

            // Hide the form
            const form = document.getElementById('form-' + action);
            if (form) {
                form.classList.remove('active');
            }

            // Get action metadata
            const metadata = actionMetadata[action];
            if (!metadata) return;

            // Find the parent insight
            const parentInsight = insightMessages.find(msg => msg.id === activeItemId);
            if (!parentInsight) return;

            // Create new action item card
            const actionId = `action-${Date.now()}-${action}`;
            const newAction = {
                id: actionId,
                parentId: parentInsight.id,
                action: action,
                status: 'in-progress',
                category: parentInsight.category,
                categoryLabel: parentInsight.categoryLabel,
                icon: parentInsight.icon,
                title: metadata.title,
                subtitle: metadata.parentTitle,
                timestamp: new Date()
            };

            // Add to submitted actions
            submittedActions.push(newAction);

            // Update action pill states (disable pill, change to 3-dot icon)
            updateActionPillStates();

            // Update notification dots (will show red dot on in-progress tab)
            updateNotificationDots();

            // Stay on current tab - don't auto-navigate
            // Just show a toast notification
            showToast(`Action started! "${metadata.title}" moved to In Progress...`);

            // Auto-complete after 5 seconds
            setTimeout(() => {
                newAction.status = 'completed';

                // Update action pill states (change to checkmark icon)
                updateActionPillStates();

                // Update notification dots for completed tab
                updateNotificationDots();

                // If still on in-progress tab, refresh
                if (currentTab === 'in-progress') {
                    renderMessages();
                }

                // Show completion toast
                showToast(`"${metadata.title}" has been completed and moved to Completed tab!`);
            }, 5000);
        }

        // Form cancel handler
        function cancelForm(action) {
            // Hide the form
            const form = document.getElementById('form-' + action);
            form.classList.remove('active');

            // Remove selected class from pill
            const pill = document.querySelector(`.action-pill[data-action="${action}"]`);
            pill.classList.remove('selected');
        }

        // Update notification dots based on tab content
        function updateNotificationDots() {
            // Count UNVIEWED items in each tab
            const inProgressUnviewed = submittedActions.filter(a =>
                a.status === 'in-progress' && !viewedActions.has(a.id)
            ).length;
            const completedUnviewed = submittedActions.filter(a =>
                a.status === 'completed' && !viewedActions.has(a.id)
            ).length;

            // Update dots
            document.querySelectorAll('.tab').forEach(tab => {
                const tabName = tab.getAttribute('data-tab');

                // Remove has-new class first
                tab.classList.remove('has-new');

                // Add has-new class if tab has UNVIEWED items
                if (tabName === 'in-progress' && inProgressUnviewed > 0) {
                    tab.classList.add('has-new');
                } else if (tabName === 'completed' && completedUnviewed > 0) {
                    tab.classList.add('has-new');
                }
            });
        }

        // Tab switching
        function updateTabUI() {
            document.querySelectorAll('.tab').forEach(tab => {
                const tabName = tab.getAttribute('data-tab');
                if (tabName === currentTab) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            // Update notification dots after switching tabs
            updateNotificationDots();
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                currentTab = this.getAttribute('data-tab');
                updateTabUI();
                activeItemId = null; // Reset active item when switching tabs
                renderMessages();
            });
        });

        document.querySelectorAll('.nav-icon').forEach(icon => {
            icon.addEventListener('click', function() {
                document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Handle permission tag close
        document.querySelectorAll('.permission-tag .material-icons').forEach(icon => {
            icon.addEventListener('click', function(e) {
                e.stopPropagation();
                this.parentElement.remove();
            });
        });

        // Handle bottom search
        document.querySelector('.search-submit').addEventListener('click', function() {
            const input = document.querySelector('.search-input');
            if (input.value.trim()) {
                alert('AI Assistant: "' + input.value + '" - This feature would connect to an AI assistant to help you manage your restaurant.');
                input.value = '';
            }
        });

        document.querySelector('.search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                showToast('AI Assistant: Processing your question...');
                this.value = '';
            }
        });

        // Toggle evidence section
        function toggleEvidence(insightId) {
            const content = document.getElementById('evidence-content-' + insightId);
            const toggle = document.getElementById('evidence-toggle-' + insightId);

            if (content.classList.contains('active')) {
                content.classList.remove('active');
                toggle.classList.remove('expanded');
            } else {
                content.classList.add('active');
                toggle.classList.add('expanded');
            }
        }

        // Expand monitoring details
        function expandMonitoring(insightId) {
            showToast('Opening detailed results dashboard for ' + insightId + '...');
            // In a real implementation, this would open a detailed view or modal
        }

        // Feedback functions
        let currentDismissInsightId = null;

        function provideFeedback(insightId, type) {
            const feedbackMessages = {
                'helpful': 'Thank you! We\'re glad this recommendation is helpful.',
                'not-helpful': 'Thank you for letting us know. Your feedback helps us improve.'
            };

            showToast(feedbackMessages[type] || 'Thank you for your feedback!');

            // In a real implementation, this would send feedback to the backend
            console.log('Feedback:', insightId, type);
        }

        function showDismissModal(insightId) {
            currentDismissInsightId = insightId;
            const modal = document.getElementById('dismissModal');
            modal.classList.add('active');

            // Reset radio buttons
            document.querySelectorAll('input[name="dismiss-reason"]').forEach(radio => {
                radio.checked = false;
            });
        }

        function closeDismissModal() {
            const modal = document.getElementById('dismissModal');
            modal.classList.remove('active');
            currentDismissInsightId = null;
        }

        function confirmDismiss() {
            const selectedReason = document.querySelector('input[name="dismiss-reason"]:checked');

            if (!selectedReason) {
                showToast('Please select a reason for dismissing this insight.');
                return;
            }

            // In a real implementation, this would send the dismissal to the backend
            showToast('Insight dismissed. You won\'t see this recommendation again.');

            closeDismissModal();

            // Hide the insight from the list (in a real implementation, this would be persisted)
            console.log('Dismissed:', currentDismissInsightId, 'Reason:', selectedReason.value);
        }

        // Snooze function
        function snoozeInsight(insightId, days) {
            const dateStr = days === 1 ? '1 day' : days + ' days';
            showToast(`This insight has been snoozed for ${dateStr}. You'll see it again on ${getSnoozeDate(days)}.`);

            // In a real implementation, this would update the insight's snooze state in the backend
            console.log('Snoozed:', insightId, 'for', days, 'days');
        }

        function getSnoozeDate(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            const options = { month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Evidence Modal functions
        function showEvidenceModal(insightId) {
            const insight = insightMessages.find(msg => msg.id === insightId);
            if (!insight || !insight.evidence) return;

            const modal = document.getElementById('evidenceModal');
            const content = document.getElementById('evidenceModalContent');

            const evidence = insight.evidence;

            // Build the modal content
            content.innerHTML = `
                <div class="evidence-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div class="evidence-item" style="display: flex; flex-direction: column; gap: 6px;">
                        <span class="evidence-label" style="font-size: 12px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Confidence Level</span>
                        <span class="evidence-value" style="font-size: 16px; font-weight: 600; color: #1a1a1a;">${evidence.confidence.value}</span>
                        <div class="confidence-bar" style="width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden; margin-top: 4px;">
                            <div class="confidence-fill ${evidence.confidence.type}" style="height: 100%; width: ${evidence.confidence.width}%; border-radius: 3px; transition: width 0.5s ease-out;"></div>
                        </div>
                    </div>
                    <div class="evidence-item" style="display: flex; flex-direction: column; gap: 6px;">
                        <span class="evidence-label" style="font-size: 12px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Data Source</span>
                        <span class="evidence-value" style="font-size: 16px; font-weight: 600; color: #1a1a1a;">${evidence.dataSource.value}</span>
                        <span style="font-size: 12px; color: #6b7280; margin-top: 2px;">${evidence.dataSource.detail}</span>
                    </div>
                    <div class="evidence-item" style="display: flex; flex-direction: column; gap: 6px;">
                        <span class="evidence-label" style="font-size: 12px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Success Rate</span>
                        <span class="evidence-value" style="font-size: 16px; font-weight: 600; color: #1a1a1a;">${evidence.successRate.value}</span>
                        <span style="font-size: 12px; color: #6b7280; margin-top: 2px;">${evidence.successRate.detail}</span>
                    </div>
                    <div class="evidence-item" style="display: flex; flex-direction: column; gap: 6px;">
                        <span class="evidence-label" style="font-size: 12px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Impact Timeframe</span>
                        <span class="evidence-value" style="font-size: 16px; font-weight: 600; color: #1a1a1a;">${evidence.timeframe.value}</span>
                        <span style="font-size: 12px; color: #6b7280; margin-top: 2px;">${evidence.timeframe.detail}</span>
                    </div>
                </div>
                <div class="evidence-description" style="font-size: 13px; color: #6b7280; line-height: 1.6; padding: 16px; background: #f9fafb; border-radius: 8px;">
                    <strong>Methodology:</strong> ${evidence.methodology}
                </div>
            `;

            modal.classList.add('active');
        }

        function closeEvidenceModal() {
            const modal = document.getElementById('evidenceModal');
            modal.classList.remove('active');
        }

        // Initialize the app
        renderMessages();
        attachActionPillListeners();
    </script>
</body>
</html>